CREATE TABLE accounts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    pub_id BIGINT NOT NULL UNIQUE,
    email TEXT NOT NULL UNIQUE,
    currency TEXT NOT NULL,
    balance NUMERIC DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TYPE txn_type AS ENUM ('deposit', 'withdrawal');

CREATE TABLE transactions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    typ txn_type NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TYPE charge_type AS ENUM ('debit', 'credit');

CREATE TABLE charges (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    typ charge_type NOT NULL,
    amount NUMERIC NOT NULL,
    tx_id BIGINT REFERENCES transactions(id) ON DELETE RESTRICT,
    acct_id BIGINT REFERENCES accounts(pub_id) ON DELETE RESTRICT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
